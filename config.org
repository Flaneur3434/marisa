#+STARTUP: overview
#+TITLE: Marisa
#+LANGUAGE: en
#+OPTIONS: num:nil
Emacs - Connect To The Wired Edition

[[./gnumarisa.png]]
* Introduction
Based off of Witchmacs(https://github.com/snackon/Witchmacs)
How to download
#+BEGIN_SRC bash
  git clone https://github.com/GrapeJuiceSoda/marisa .emacs.d
  cd .emacs.d
  git submodule update --init
  # requires sregx (https://github.com/zyedidia/sregx)
  # requires fzy (https://github.com/jhawthorn/fzy)
  ./update-git-packages.sh --init
  ./update-git-packages.sh --update
#+END_SRC
* Why would I use this?
#+BEGIN_QUOTE
A very basic config (KISS!)
#+END_QUOTE
I used Witchmacs because as opposed to many other Emacs distributions, Witchmacs has ZERO customization layers which means you can just jump in, look at the config file and start editing away!
After all, Emacs works best when it's customized to your own liking!
* Dependencies
=clang= as backend for C and C++ autocompletion

=llvm= to install irony server

(optional) =mvn= maven for java project handling through =meghanada=
* QoL section
Minor quality-of-life modifications for a more pleasant Emacs experience
** Enable line numbers
Emacs breaks certain modes when it has line-numbers-mode enabled, (like docview or ansi-term) so I utilize the approach of only enabling it on some major modes rather than globally
#+BEGIN_SRC emacs-lisp
  (add-hook 'prog-mode-hook 'display-line-numbers-mode)
  (add-hook 'text-mode-hook 'display-line-numbers-mode)
#+END_SRC
Use absolute line numbers even when buffer is narrowed.
#+BEGIN_SRC emacs-lisp
  (customize-set-variable 'display-line-numbers-widen t)
#+END_SRC
** Show parent parentheses
#+BEGIN_SRC emacs-lisp
  (show-paren-mode 1)
#+END_SRC
** Disable the default startup screen
#+BEGIN_SRC emacs-lisp
  (setq inhibit-startup-message t)
#+END_SRC
** Disable most gui elements
#+BEGIN_SRC emacs-lisp
  (tool-bar-mode -1)
  (menu-bar-mode -1)
  (scroll-bar-mode -1)
#+END_SRC
** Enable copypasting outside of Emacs
#+BEGIN_SRC emacs-lisp
  (setq x-select-enable-clipboard t)
#+END_SRC
** Disable automatic creation of backup files
#+BEGIN_SRC emacs-lisp
  (setq make-backup-files nil)
  (setq auto-save-default nil)
#+END_SRC
** Enable conservative scrolling
#+BEGIN_SRC emacs-lisp
  (setq scroll-conservatively 101)
#+END_SRC
** Disable ring-bell
#+BEGIN_SRC emacs-lisp
  (setq ring-bell-function 'ignore)
#+END_SRC
** Indentation
#+BEGIN_SRC emacs-lisp
  (setq-default tab-width 4)
  (setq-default standard-indent 4)
  (setq c-basic-offset tab-width)
  (setq-default electric-indent-inhibit t)
  (setq-default indent-tabs-mode t)
  (setq backward-delete-char-untabify-method 'nil)
#+END_SRC
** Paragraph Filling
#+BEGIN_SRC emacs-lisp
  (setq-default fill-column 80)
#+END_SRC
** Enable prettify symbols mode
#+BEGIN_SRC emacs-lisp
  (global-prettify-symbols-mode t)
#+END_SRC
** Enable bracket pair-matching
#+BEGIN_SRC emacs-lisp
  (setq electric-pair-pairs '(
                              (?\{ . ?\})
                              (?\( . ?\))
                              (?\[ . ?\])
                              (?\" . ?\")
                              ))
  (electric-pair-mode t)
#+END_SRC
** Transform yes-or-no questions into y-or-n
#+BEGIN_SRC emacs-lisp
  (defalias 'yes-or-no-p 'y-or-n-p)
#+END_SRC
** Highlight current line
#+BEGIN_SRC emacs-lisp
  (global-hl-line-mode t)
#+END_SRC
** Defer loading most packages for quicker startup times
#+BEGIN_SRC emacs-lisp
 (setq use-package-always-defer t)
#+END_SRC
** Default encoding
#+BEGIN_SRC emacs-lisp
  (prefer-coding-system 'utf-8-unix)
  (set-language-environment "UTF-8")
  (set-default-coding-systems 'utf-8-unix)
  (set-terminal-coding-system 'utf-8-unix)
  (set-keyboard-coding-system 'utf-8-unix)
  (set-selection-coding-system 'utf-8-unix)
  (setq-default buffer-file-coding-system 'utf-8-unix)
#+END_SRC
** Completion and Minibuffer settings
#+BEGIN_SRC emacs-lisp
  (setq completion-ignore-case t)
  (setq read-buffer-completion-ignore-case t)
  (setq read-file-name-completion-ignore-case t)
  (setq completion-show-inline-help nil)
  (setq completions-detailed t)
  (setq resize-mini-windows t)
  (minibuffer-depth-indicate-mode 1)
  (minibuffer-electric-default-mode 1)
  (setq minibuffer-prompt-properties
        '(read-only t cursor-intangible t face minibuffer-prompt))
  (add-hook 'minibuffer-setup-hook #'cursor-intangible-mode)
#+END_SRC
** Delete trailing whitespace before saving a file
#+BEGIN_SRC emacs-lisp
  (add-hook 'before-save-hook 'delete-trailing-whitespace)
#+END_SRC
** Create an indirect buffer with narrow view
** Dired Qol
#+BEGIN_SRC emacs-lisp
  (require 'dired-x)
  (add-hook 'dired-mode-hook 'auto-revert-mode)
#+END_SRC
*** Create a new file from dired mode
#+BEGIN_SRC emacs-lisp
  (eval-after-load 'dired
    '(progn
       (define-key dired-mode-map (kbd "c") 'my-dired-create-file)
       (defun create-new-file (file-list)
         (defun exsitp-untitled-x (file-list cnt)
           (while (and (car file-list) (not (string= (car file-list) (concat "untitled" (number-to-string cnt) ".txt"))))
             (setq file-list (cdr file-list)))
           (car file-list))

         (defun exsitp-untitled (file-list)
           (while (and (car file-list) (not (string= (car file-list) "untitled.txt")))
             (setq file-list (cdr file-list)))
           (car file-list))

         (if (not (exsitp-untitled file-list))
             "untitled.txt"
           (let ((cnt 2))
             (while (exsitp-untitled-x file-list cnt)
               (setq cnt (1+ cnt)))
             (concat "untitled" (number-to-string cnt) ".txt")
             )
           )
         )
       (defun my-dired-create-file (file)
         (interactive
          (list (read-file-name "Create file: " (concat (dired-current-directory) (create-new-file (directory-files (dired-current-directory))))))
          )
         (write-region "" nil (expand-file-name file) t)
         (dired-add-file file)
         (revert-buffer)
         (dired-goto-file (expand-file-name file))
         )
       )
    )
  #+END_SRC
*** Create a new window and open dired there
#+BEGIN_SRC emacs-lisp
    (defun my-display-buffer-below (buffer alist)
    "Doc-string."
      (let (
          (window
            (cond
              ((get-buffer-window buffer (selected-frame)))
              ((window-in-direction 'below))
              (t
                (split-window (selected-window) nil 'below)))))
        (window--display-buffer buffer window 'window alist display-buffer-mark-dedicated)
        window))

    (defun my-display-buffer-above (buffer alist)
    "Doc-string."
      (let (
          (window
            (cond
              ((get-buffer-window buffer (selected-frame)))
              ((window-in-direction 'above))
              (t
                (split-window (selected-window) nil 'above)))))
        (window--display-buffer buffer window 'window alist display-buffer-mark-dedicated)
        window))

    (defun my-display-buffer-left (buffer alist)
    "Doc-string."
      (let (
          (window
            (cond
              ((get-buffer-window buffer (selected-frame)))
              ((window-in-direction 'left))
              (t
                (split-window (selected-window) nil 'left)))))
        (window--display-buffer buffer window 'window alist display-buffer-mark-dedicated)
        window))

    (defun my-display-buffer-right (buffer alist)
    "Doc-string."
      (let (
          (window
            (cond
              ((get-buffer-window buffer (selected-frame)))
              ((window-in-direction 'right))
              (t
                (split-window (selected-window) nil 'right)))))
        (window--display-buffer buffer window 'window alist display-buffer-mark-dedicated)
        window))

    (defun dired-display-above ()
    "Doc-string."
    (interactive)
      (let* (
          (file-or-dir (dired-get-file-for-visit))
          (buffer (find-file-noselect file-or-dir)))
        (my-display-buffer-above buffer nil)))

    (defun dired-display-below ()
    "Doc-string."
    (interactive)
      (let* (
          (file-or-dir (dired-get-file-for-visit))
          (buffer (find-file-noselect file-or-dir)))
        (my-display-buffer-below buffer nil)))

    (defun dired-display-left ()
    "Doc-string."
    (interactive)
      (let* (
          (file-or-dir (dired-get-file-for-visit))
          (buffer (find-file-noselect file-or-dir)))
        (my-display-buffer-left buffer nil)))

    (defun dired-display-right ()
    "Doc-string."
    (interactive)
      (let* (
          (file-or-dir (dired-get-file-for-visit))
          (buffer (find-file-noselect file-or-dir)))
        (my-display-buffer-right buffer nil)))
  (define-key dired-mode-map (kbd "C-x i") 'dired-display-above)
  (define-key dired-mode-map (kbd "C-x k") 'dired-display-below)
  (define-key dired-mode-map (kbd "C-x j") 'dired-display-left)
  (define-key dired-mode-map (kbd "C-x l") 'dired-display-right)
#+END_SRC
*** Deleting dired buffer
**** Look under ibuffer
** Quickly access config.org and eval init.el
#+BEGIN_SRC emacs-lisp
  (defun config-visit ()
    (interactive)
    (find-file "~/.emacs.d/config.org"))
  (global-set-key (kbd "C-c e") 'config-visit)

  (defun eval-init-file ()
    (interactive)
    (load-file "~/.emacs.d/init.el"))
  (global-set-key (kbd "C-c r") 'eval-init-file)
#+END_SRC
** ibuffer
#+BEGIN_SRC emacs-lisp
  (setq-default ibuffer-saved-filter-groups
                `(("Default"
                   ;; In the ibuffer window, group all of the buffers with dired-mode enabled
                   ("Dired" (mode . dired-mode))
                   ("Temporary" (name . "\*.*\*"))
                   )))

  (defun open-ibuffer-and-move ()
     (interactive)
     (split-window-below)
     (ibuffer))
  (global-set-key (kbd "C-x k") 'open-ibuffer-and-move)
#+END_SRC
** Diff Mode
#+BEGIN_SRC emacs-lisp
  (setq diff-default-read-only t)
  (setq diff-advance-after-apply-hunk t)
  (setq diff-update-on-the-fly t)
  (setq diff-refine nil)
  (setq diff-font-lock-prettify nil)
  (setq diff-font-lock-syntax 'hunk-also)

  (xah-fly--define-keys
   (define-prefix-command 'ken_nc/dired-keymap)
   '(
     ("o" . dired-sort-size)
     ("." . dired-sort-extension)
     ("j" . dired-sort-ctime)
     ("u" . dired-sort-utime)
     ("p" . dired-sort-name)))
#+END_SRC
** Crux keybinds
#+BEGIN_SRC emacs-lisp
  (xah-fly--define-keys
   (define-prefix-command 'ken_nc/crux-keymap)
   '(
     ("u" . crux-recentf-find-file)
     ("p" . crux-rename-file-and-buffer)
     ("q" . crux-transpose-windows)
     ("b" . darkroom-tentative-mode)
     ("o" . crux-sudo-edit)
     ("e" . crux-delete-file-and-buffer)
     ("d" . ken_nc/grep-symbol-at-point)
     ("i" . ken_nc/grep-dwim)
     (">" . mpc-next)
     ("<" . mpc-prev)
     ("]" . mpc-pause)
     ("+" . mpc-resume)
     ("m" . ken_nc/mozc-dwim)
     ("h" . strip-regular-expression-string)))
  ;;  TODO 2022-01-11: Add crux-open-with
#+END_SRC
** Prot Function keybinds
#+BEGIN_SRC emacs-lisp
  (xah-fly--define-keys
   (define-prefix-command 'ken_nc/prot-keymap)
   '(
     ("n" . prot-simple-narrow-dwim)
     ("j" . prot-comment-timestamp-keyword)
     ("u" . prot-simple-delete-pair-dwim)
     ("e" . prot-diff-buffer-dwim)))
  ;;  TODO 2022-01-07: Add / Change MCT keybinds
  ;;  TODO 2022-01-07: Add prot-text.el keybindings
  ;;  TODO 2022-01-07: Add prot-comment.el keybindings
  ;;  TODO 2022-01-07: Add prot-spell.el keybindings
  ;;  TODO 2022-01-11: Add prot-eshell keybinds (cd history, redirect to buffer)
#+END_SRC
** General Keybindings
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "C-c z") 'remember)
  (global-set-key (kbd "C-c q") 'ken_nc/quit-emacs-dwim) ; TODO 2022-01-05: Change so its dwim
  (global-set-key (kbd "C-c t") 'ken_nc/create-tags)

  (global-set-key (kbd "M-i") 'move-text-up)
  (global-set-key (kbd "M-k") 'move-text-down)
  (global-set-key (kbd "M-RET") 'indent-new-comment-line)
#+END_SRC
** xah-fly-keys leader keymap
#+BEGIN_SRC emacs-lisp
  (xah-fly--define-keys
   (define-prefix-command 'xah-fly-leader-key-map)
   '(
     ("SPC" . xah-fly-insert-mode-activate)
     ("DEL" . xah-fly-insert-mode-activate)
     ("RET" . xah-fly-M-x)
     ("TAB" . xah-fly--tab-key-map)
     ("." . xah-fly-highlight-keymap)
     ("'" . xah-fill-or-unfill)
     ("," . xah-fly-comma-keymap)
     ("-" . xah-show-formfeed-as-line)
     ;; /
     ;; ;
     ;; =
     ;; [
     ("\\" . toggle-input-method)
     ;; `

     ;; 1
     ;; 2
     ("3" . delete-window)
     ("4" . split-window-right)
     ("5" . balance-windows)
     ("6" . xah-upcase-sentence)
     ;; 7
     ;; 8
     ("9" . ispell-word)
     ;; 0

     ("a" . mark-whole-buffer)
     ("b" . end-of-buffer)
     ("c" . xah-fly-file-keymap)
     ("d" . beginning-of-buffer)
     ("e" . xah-fly-insert-keymap)
     ("f" . xah-search-current-word)
     ("g" . xah-close-current-buffer)
     ("h" . xah-fly-describe-keymap)
     ("i" . kill-line)
     ("j" . xah-copy-all-or-region)
     ("k" . xah-fly-tag-keymap)
     ;; ("l" . recenter-top-bottom)
     ("l" . ken_nc/prot-keymap)
     ("m" . dired-jump)
     ("n" . xah-fly-buffer-keymap)
     ;; ("o" . exchange-point-and-mark)
     ("o" . ken_nc/crux-keymap)
     ("p" . query-replace)
     ("q" . xah-cut-all-or-region)
     ("r" . xah-fly-visual-keymap)
     ;; ("s" . save-buffer)
     ("s" . ken_nc/save-buffer-dwim)
     ("t" . xah-fly-edit-keymap)
     ("u" . switch-to-buffer)
     ;; v
     ("w" . xah-fly-eval-keymap)
     ;; ("x" . xah-toggle-previous-letter-case)
     ("x" . ken_nc/pop-local-mark-ring)
     ;; ("y" . xah-show-kill-ring)
     ("y" . ken_nc/dired-keymap)
     ;; z
     ;;
     ))
#+END_SRC
** CSS color coding
#+BEGIN_SRC emacs-lisp
  (defun xah-syntax-color-hex ()
    "Syntax color text of the form #ff1100 and #abc in current buffer.
  URL `http://ergoemacs.org/emacs/emacs_CSS_colors.html'
  Version 2017-03-12"
    (interactive)
    (font-lock-add-keywords
     nil
     '(("#[[:xdigit:]]\\{3\\}"
        (0 (put-text-property
            (match-beginning 0)
            (match-end 0)
            'face (list :background
                        (let* (
                               (ms (match-string-no-properties 0))
                               (r (substring ms 1 2))
                               (g (substring ms 2 3))
                               (b (substring ms 3 4)))
                          (concat "#" r r g g b b))))))
       ("#[[:xdigit:]]\\{6\\}"
        (0 (put-text-property
            (match-beginning 0)
            (match-end 0)
            'face (list :background (match-string-no-properties 0)))))))
    (font-lock-flush))
  (add-hook 'prog-mode-hook 'xah-syntax-color-hex)
  (add-hook 'conf-xdefaults-mode-hook 'xah-syntax-color-hex)
#+END_SRC
** Tramp
#+BEGIN_SRC emacs-lisp
  (require 'tramp)
#+END_SRC
*** Dired sudo mode
You can also edit files in sudo mode with crux-edit-sudo
#+BEGIN_SRC emacs-lisp
  (defun sudired ()
    (interactive)
    (require 'tramp)
    (let ((dir (expand-file-name default-directory)))
      (if (string-match "^/sudo:" dir)
          (user-error "Already in sudo")
        (dired (concat "/sudo::" dir)))))
  (define-key dired-mode-map "!" 'sudired)
#+END_SRC
*** SSH editing with tramp
Others remote file editing packages use FTP to connect to the remote host and to transfer the files, TRAMP uses a remote shell connection (rlogin, telnet, ssh).
#+BEGIN_SRC emacs-lisp
  (setq tramp-default-method "ssh")
#+END_SRC
** Isearch functionality
The defualt functionality of isearch is to put the cursor after the last character searched. Thats bad usability. Changed so that the cusor is moved to the beginning of the match searched.
#+BEGIN_SRC emacs-lisp
  (defun my-goto-match-beginning ()
      (when (and isearch-forward isearch-other-end (not isearch-mode-end-hook-quit))
        (goto-char isearch-other-end)))
  (defadvice isearch-exit (after my-goto-match-beginning activate)
    "Go to beginning of match."
    (when (and isearch-forward isearch-other-end)
      (goto-char isearch-other-end)))
  (add-hook 'isearch-mode-end-hook 'my-goto-match-beginning)
#+END_SRC
** WGrep
WGrep allows you to edit a grep buffer and apply those changes to the file buffer like sed interactively. No need to learn sed script, just learn Emacs.

Save buffer automatically when wgrep-finish-edit
#+BEGIN_SRC emacs-lisp
  (setq wgrep-auto-save-buffer t)
#+END_SRC
Change the default key binding to switch to wgrep
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "C-q") 'ken_nc/edit-buffer-dwim)
#+END_SRC
Default grep flags
#+BEGIN_SRC emacs-lisp
  (grep-apply-setting
   'grep-template
   "--color --ignore-case --line-number --with-filename --recursive --null --regexp")
#+END_SRC
** Emacs default completion for elisp
Emacs has its own built-in functionality which enables TAB completion for elisp
#+BEGIN_SRC emacs-lisp
  (setq tab-always-indent 'complete)
  (add-to-list 'completion-styles 'initial t)
#+END_SRC
** Setup mouse click to highlight matching words
#+BEGIN_SRC emacs-lisp
  (defun ken_nc/find-word-on-click (event)
    (interactive "e")
    (let ((word-at-point  (posn-point (event-end event))))
      (goto-char word-at-point)
      (isearch-forward-symbol-at-point)))

  (global-set-key (kbd "<mouse-3>") 'ken_nc/find-word-on-click)
#+END_SRC
** Auto Complete in IELM
#+BEGIN_SRC emacs-lisp
  (defun ielm-auto-complete ()
    "Enables `auto-complete' support in \\[ielm]."
    (setq ac-sources '(ac-source-functions
                       ac-source-variables
                       ac-source-features
                       ac-source-symbols
                       ac-source-words-in-same-mode-buffers))
    (add-to-list 'ac-modes 'inferior-emacs-lisp-mode)
    (auto-complete-mode 1))
  (add-hook 'ielm-mode-hook 'ielm-auto-complete)
#+END_SRC
** Music in emacs
#+BEGIN_SRC emacs-lisp
  (setq
   mpc-browser-tags '(Artist Album)
   mpc-songs-format "%-5{Time} %25{Title} %20{Album} %20{Artist}")
#+END_SRC
** Mode line Customization
#+BEGIN_SRC emacs-lisp
  (add-hook 'text-mode-hook 'wc-mode)
  (add-hook 'prog-mode-hook 'wc-mode)
  (setq wc-modeline-format "[Words: %tw, Lines: %tl]")
#+END_SRC
* Emacs Daemon
Emacs frame settings that need to started when emacs is in daemon mode.
These include the frame (window) size, xah-fly-keys settings, and font settings.
#+BEGIN_SRC emacs-lisp
  (server-start)
  (setq initial-buffer-choice (lambda () (get-buffer "*dashboard*")))

  (when (member "Source Code Pro" (font-family-list))
    (set-frame-font "Source Code Pro" t t))
  (defun ken_nc/setup-emacsclient (frame)
    (select-frame frame)
    (load-theme 'xresources t)
    ;; (set-frame-position (selected-frame) 0 0)
    ;; (set-frame-size (selected-frame) 800 1000 t)
    (setq xah-fly-use-control-key nil)
    (xah-fly-keys-set-layout "qwerty")
    (xah-fly-keys t))

  (if (daemonp)
      (add-hook 'after-make-frame-functions
                #'ken_nc/setup-emacsclient)
    (progn
      (load-theme 'xresources t)))
#+END_SRC
* Org mode
** Description
One of the main selling points of Emacs! no Emacs distribution is complete without sensible and well-defined org-mode defaults
** Code
#+BEGIN_SRC emacs-lisp
  (use-package org
    :config
    (add-hook 'org-mode-hook 'org-indent-mode)
    (add-hook 'org-mode-hook
              '(lambda ()
                 (visual-line-mode 1)))
    (setq org-startup-folded t))

  (use-package org-indent-
    :diminish org-indent-mode)
  (set-face-attribute 'org-block nil
                      :background "#0a0a0a")
#+END_SRC
* Eshell
** Why Eshell?
We are using Emacs, so we might as well implement as many tools from our workflow into it as possible
*** Caveats
Eshell cannot handle ncurses programs and in certain interpreters (Python, GHCi) selecting previous commands does not work (for now). I recommend using eshell for light cli work, and using your external terminal emulator of choice for heavier tasks
** Prompt
#+BEGIN_SRC emacs-lisp
  (setq eshell-prompt-regexp "^[^É…\n]*[É…] ")
  (setq eshell-prompt-function
        (lambda nil
          (concat
           (if (string= (eshell/pwd) (getenv "HOME"))
               (propertize "~" 'face `(:foreground "#99CCFF"))
             (replace-regexp-in-string
              (getenv "HOME")
              (propertize "~" 'face `(:foreground "#99CCFF"))
              (propertize (eshell/pwd) 'face `(:foreground "#99CCFF"))))
           (if (= (user-uid) 0)
               (propertize " Éø " 'face `(:foreground "#FF6666"))
             (propertize " É… " 'face `(:foreground "#A6E22E"))))))

  (setq eshell-highlight-prompt nil)
#+END_SRC
** Aliases
#+BEGIN_SRC emacs-lisp
  (defalias 'open 'find-file-other-window)
  (defalias 'clean 'eshell/clear-scrollback)
#+END_SRC
** Custom functions
*** Open files as root
#+BEGIN_SRC emacs-lisp
  (defun eshell/sudo-open (filename)
    "Open a file as root in Eshell."
    (let ((qual-filename (if (string-match "^/" filename)
                             filename
                           (concat (expand-file-name (eshell/pwd)) "/" filename))))
      (switch-to-buffer
       (find-file-noselect
        (concat "/sudo::" qual-filename)))))
#+END_SRC
*** Super - Control - RET to open eshell
#+BEGIN_SRC emacs-lisp
  (defun eshell-other-window ()
    "Create or visit an eshell buffer."
    (interactive)
    (if (not (get-buffer "*eshell*"))
        (progn
          (split-window-sensibly (selected-window))
          (other-window 1)
          (eshell))
      (switch-to-buffer-other-window "*eshell*")))

  (global-set-key (kbd "<s-C-return>") 'eshell-other-window)
#+END_SRC
* Use-package section
** Initialize =auto-package-update=
*** Description
Auto-package-update automatically updates and removes old packages
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package auto-package-update
    :defer nil
    :ensure t
    :config
    (setq auto-package-update-delete-old-versions t)
    (setq auto-package-update-hide-results t)
    (auto-package-update-maybe))
#+END_SRC
** Initialize =which-key=
*** Description
Incredibly useful package; if you are in the middle of a command and don't know what to type next, just wait a second and you'll get a nice buffer with all possible completions
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package which-key
    :ensure t
    :init
    (which-key-mode))
#+END_SRC
** Initialize =diminish=
*** Description
Diminish hides minor modes to prevent cluttering your mode line
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package diminish
    :ensure t)
#+END_SRC
** Initialize =dashboard=
*** Description
The frontend of Witchmacs; without this there'd be no Marisa in your Emacs startup screen
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package dashboard
    :defer nil
    :ensure t
    :preface
    (defun update-config ()
      "Update Witchmacs to the latest version."
      (interactive)
      (let ((dir (expand-file-name user-emacs-directory)))
        (if (file-exists-p dir)
            (progn
              (message "Marisa is updating!")
              (cd dir)
              (shell-command "git pull")
              (message "Update finished. Switch to the messages buffer to see changes and then restart Emacs"))
          (message "\"%s\" doesn't exist." dir))))

    (defun create-scratch-buffer ()
      "Create a scratch buffer"
      (interactive)
      (switch-to-buffer (get-buffer-create "*scratch*"))
      (lisp-interaction-mode))
    :config
    (dashboard-setup-startup-hook)
    (setq dashboard-items '((recents . 5)))
    (setq dashboard-banner-logo-title "M A R I S A - Connect To The Wired Edition!")
    ;; (setq dashboard-startup-banner "~/.emacs.d/lain.png")
    (setq dashboard-startup-banner "~/.emacs.d/athos_monk_emacs.png")
    (setq dashboard-center-content t)
    (setq dashboard-show-shortcuts nil)
    (setq dashboard-set-init-info t)
    (setq dashboard-init-info (format "%d packages loaded in %s"
                                      (length package-activated-list) (emacs-init-time)))
    (setq dashboard-set-footer nil)
    (setq dashboard-set-navigator t)
    (setq dashboard-navigator-buttons
          `(;; line1
            ((,nil
              "Witchmacs on github"
              "Open Marisa on github"
              (lambda (&rest _) (browse-url "https://github.com/GrapeJuiceSoda/marisa"))
              'default)
             (nil
              "Witchmacs crash course"
              "Open Witchmacs' introduction to Emacs"
              (lambda (&rest _) (find-file "~/.emacs.d/Witcheat.org"))
              'default)
             (nil
              "Update Witchmacs"
              "Get the latest Witchmacs update. Check out the github commits for changes!"
              (lambda (&rest _) (update-config))
              'default)
             )
            ;; line 2
            ((,nil
              "Open scratch buffer"
              "Switch to the scratch buffer"
              (lambda (&rest _) (create-scratch-buffer))
              'default)
             (nil
              "Open config.org"
              "Open Marisa' configuration file for easy editing"
              (lambda (&rest _) (find-file "~/.emacs.d/config.org"))
              'default)))))
#+END_SRC
*** Notes
If you pay close attention to the code in dashboard, you'll  notice that it uses custom functions defined under the :preface use-package block. I wrote all of those functions by looking at other people's Emacs distributions (Mainly [[https://github.com/seagle0128/.emacs.d][Centaur Emacs]]) and then experimenting and adapting them to Witchmacs. If you dig around, you'll find the same things I did - maybe even more!
*** Historical
22/05/19: On this day, the main maintainers of the dashboard package have added built-in fuinctionality to display init and package load time, thing that I already had implemented much earlier on my own. I have left here my implementation for historical purposes
#+BEGIN_SRC emacs-lisp
  ;(insert (concat
  ;         (propertize (format "%d packages loaded in %s"
  ;                             (length package-activated-list) (emacs-init-time))
  ;                     'face 'font-lock-comment-face)))
  ;
  ;(dashboard-center-line)
#+END_SRC
** Initialize =beacon=
*** Description
You might find beacon an unnecesary package but I find it very neat. It briefly highlights the cursor position when switching to a new window or buffer
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package beacon
    :ensure t
    :diminish beacon-mode
    :init
    (beacon-mode 1))
#+END_SRC
** Initialize =htmlize=
*** Description
Highligh rgb and hex values with the color associated with them
*** Code
#+BEGIN_SRC emacs-lisp
   (use-package htmlize
     :ensure t)
#+END_SRC
** Initialize =mozc=
*** ì˙ñ{åÍì¸óÕ
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package mozc
    :ensure t)
#+END_SRC
** Initialize =ido= and =ido-vertical=
*** Description
For the longest time I used the default way of switching and killing buffers in Emacs. Same for finding files. Ido-mode made these three tasks IMMENSELY easier and more intuitive. Please not that I still use the default way M - x works because I believe all you really need for it is which-key
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package ido
    :init
    (ido-mode 1)
    :config
    (setq ido-enable-flex-matching nil)
    (setq ido-create-new-buffer 'always)
    (setq ido-everywhere t))

  (use-package ido-vertical-mode
    :ensure t
    :init
    (ido-vertical-mode 1))
  ; This enables arrow keys to select while in ido mode. If you want to
  ; instead use the default Emacs keybindings, change it to
  ; "'C-n-and-C-p-only"
  (setq ido-vertical-define-keys 'C-n-C-p-up-and-down)
#+END_SRC
** Initialize =async=
*** Description
Utilize asynchronous processes whenever possible
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package async
	:ensure t
	:init
	(dired-async-mode 1))
#+END_SRC
** Initialize =page-break-lines=
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package page-break-lines
    :ensure t
    :diminish (page-break-lines-mode visual-line-mode))
#+END_SRC
** Initialize =undo-tree=
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package undo-tree
    :ensure t
    :diminish undo-tree-mode)
#+END_SRC
** Initialize =crux=
*** Description
A Collection of Ridiculously Useful eXtensions for Emac
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package crux
    :ensure t)
#+END_SRC
** Initialize =dired-toggle-sudo=
*** Code
Allow to switch from current user to sudo when browsind `dired' buffers.
#+BEGIN_SRC emacs-lisp
  (use-package dired-toggle-sudo
  :ensure t)
#+END_SRC
** Initialize =magit=
*** Description
Git porcelain for Emacs
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package magit
    :ensure t)
#+END_SRC
** Initialize =expand-region=
*** Description
Expand region increases the selected region by semantic units. Just keep pressing the key until it selects what you want.
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package expand-region
    :ensure t)
#+END_SRC
** Initialize =highlight=
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package highlight
    :ensure t)
#+END_SRC
** Initialize =screenshot=
#+BEGIN_SRC emacs-lisp
  (setq screenshot-schemes
        '(
          ("local"
           :dir "~/Pictures/screenshots/")            ; Image repository directory
          ("current-directory"          ; No need to modify
           :dir default-directory)
          ("local-server"
           :dir "/volume2/backup/thinkpad_backup/kennc_Pic/screenshots"           ; local server directory
           :url "https://192.168.1.115/")))     ; local server URL prefix
  (setq screenshot-default-scheme "local") ; default scheme is "local"
#+END_SRC
** Built-in entry: =eldoc=
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package eldoc
    :diminish eldoc-mode)
#+END_SRC
** Built-in entry: =abbrev=
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package abbrev
    :diminish abbrev-mode)
#+END_SRC
* Programming section
** Initialize =flycheck=
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package flycheck
    :ensure t
    :config
    (add-hook 'java-mode-hook 'flycheck-mode)
    (add-hook 'c-mode-hook 'flycheck-mode))
#+END_SRC
** Initialize =corfu=
*** Description
Corfu enhances the default completion in region function with a completion overlay.
*** Code
#+BEGIN_SRC emacs-lisp
  (setq corfu-cycle t)
  (setq corfu-auto t)
  (setq corfu-quit-no-match t)
  (setq corfu-quit-at-boundary t)
  (setq corfu-preview-current t)
  (setq corfu-preselect-first nil)

  ;; Use TAB for cycling, default is `corfu-complete'.
  (define-key corfu-map (kbd "TAB")  #'corfu-next)
  (define-key corfu-map (kbd "S-TAB") #'corfu-previous)

  (defun corfu-enable-in-minibuffer ()
    "Enable Corfu in the minibuffer only if Vertico or MCT is not active."
    (unless (or (bound-and-true-p mct--active))
      (corfu-mode 1)))
  (add-hook 'minibuffer-setup-hook #'corfu-enable-in-minibuffer 1)

  (add-hook 'prog-mode-hook 'corfu-mode)
  (add-hook 'eshell-mode-hook
            (lambda ()
              (setq-local corfu-quit-at-boundary t
                          corfu-quit-no-match t
                          corfu-auto nil)
              (corfu-mode)))

  (add-to-list 'corfu-auto-commands 'auto-complete)

  ;; A few more useful configurations...
  (use-package emacs
    :init
    ;; TAB cycle if there are only few candidates
    (setq completion-cycle-threshold 3)

    ;; Emacs 28: Hide commands in M-x which do not apply to the current mode.
    ;; Corfu commands are hidden, since they are not supposed to be used via M-x.
    (setq read-extended-command-predicate
          #'command-completion-default-include-p)

    ;; Enable indentation+completion using the TAB key.
    ;; `completion-at-point' is often bound to M-TAB.
    (setq tab-always-indent 'complete)
    (setq enable-recursive-minibuffers t))
#+END_SRC
** Cape
*** Description
*** Code
#+BEGIN_SRC emacs-lisp
   (add-to-list 'completion-at-point-functions #'cape-file)
   (add-to-list 'completion-at-point-functions #'cape-keyword)
   (add-to-list 'completion-at-point-functions #'cape-dabbrev)
   (add-to-list 'completion-at-point-functions #'cape-symbol)

   ;; Shell completion
   (advice-add 'pcomplete-completions-at-point :around #'cape-wrap-silent)
   (advice-add 'pcomplete-completions-at-point :around #'cape-wrap-purify)
#+END_SRC
** Orderless
*** Description
This package provides an orderless completion style that divides the pattern into space-separated components, and matches candidates that match all of the components in any order.
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package orderless
    :init
    (setq completion-styles '(basic flex orderless )))
#+END_SRC
** C & C++
*** Description
Irony is the company backend for C and C++
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package irony
    :defer nil
    :ensure t)

  (add-hook 'c-mode-hook 'ken_nc/ac-c-headers-init)
  (add-hook 'c++-mode-hook 'irony-mode)
  (add-hook 'c-mode-hook 'irony-mode)
  (add-hook 'irony-mode-hook 'irony-cdb-autosetup-compile-options)

  (defun ken_nc/ac-c-headers-init ()
    (add-to-list 'ac-sources 'ac-source-c-headers))

  (add-hook 'c++-mode-hook 'ken_nc/ac-c-headers-init)
  (add-hook 'c-mode-common-hook
            (lambda()
              (subword-mode)
              (google-set-c-style)
              (google-make-newline-indent)))
#+END_SRC
** Go
#+BEGIN_SRC emacs-lisp
  (use-package go-mode
    :defer nil
    :ensure t)
#+END_SRC
** Java
*** Description
Meghanada provides autocompletion when editing Java files. I use it mainly for autocompletion but thereÅfs a ton of other things it can do, automatic imports, for example.
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package meghanada
    :defer nil
    :ensure t
    :config
    (add-hook 'java-mode-hook
              (lambda ()
                (meghanada-mode t)))
    (setq meghanada-java-path "java")
    (setq meghanada-maven-path "mvn"))
#+END_SRC
** Elisp Format
*** Description
ElispFormat is a mode that format elisp code
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package elisp-format
    :defer nil
    :ensure t)
#+END_SRC
** Scheme =geiser-mit=
*** Description
Collection of Emacs major and minor modes that work with scheme
*** Code
#+BEGIN_SRC emacs-lisp
  (use-package geiser-mit
    :defer nil
    :ensure t
    :config
    (add-hook 'geiser-mode-hook
              (lambda ()
                (local-set-key (kbd "C-c C-b") 'geiser-eval-buffer-and-go)
                (local-set-key (kbd "C-x C-e") 'geiser-eval-region-and-go))))
#+END_SRC
